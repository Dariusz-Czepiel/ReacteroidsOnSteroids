var app=function(){"use strict";function t(){}function e(t){return t()}function i(){return Object.create(null)}function s(t){t.forEach(e)}function o(t){return"function"==typeof t}function n(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function r(e,i,s){e.$$.on_destroy.push(function(e,...i){if(null==e)return t;const s=e.subscribe(...i);return s.unsubscribe?()=>s.unsubscribe():s}(i,s))}function a(t,e,i=e){return t.set(i),e}function h(t,e){t.appendChild(e)}function c(t,e,i){t.insertBefore(e,i||null)}function l(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function p(){return d(" ")}function f(t,e,i){null==i?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function y(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}let g;function x(t){g=t}function m(){if(!g)throw new Error("Function called outside component initialization");return g}function v(t){m().$$.on_mount.push(t)}function $(t){m().$$.on_destroy.push(t)}const w=[],S=[],b=[],k=[],M=Promise.resolve();let P=!1;function _(t){b.push(t)}let E=!1;const T=new Set;function G(){if(!E){E=!0;do{for(let t=0;t<w.length;t+=1){const e=w[t];x(e),L(e.$$)}for(w.length=0;S.length;)S.pop()();for(let t=0;t<b.length;t+=1){const e=b[t];T.has(e)||(T.add(e),e())}b.length=0}while(w.length);for(;k.length;)k.pop()();P=!1,E=!1,T.clear()}}function L(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(_)}}const A=new Set;function D(t,e){t&&t.i&&(A.delete(t),t.i(e))}function I(t,e,i,s){if(t&&t.o){if(A.has(t))return;A.add(t),(void 0).c.push(()=>{A.delete(t),s&&(i&&t.d(1),s())}),t.o(e)}}function R(t){t&&t.c()}function j(t,i,n){const{fragment:r,on_mount:a,on_destroy:h,after_update:c}=t.$$;r&&r.m(i,n),_(()=>{const i=a.map(e).filter(o);h?h.push(...i):s(i),t.$$.on_mount=[]}),c.forEach(_)}function z(t,e){const i=t.$$;null!==i.fragment&&(s(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function F(t,e){-1===t.$$.dirty[0]&&(w.push(t),P||(P=!0,M.then(G)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function O(e,o,n,r,a,h,c=[-1]){const u=g;x(e);const d=o.props||{},p=e.$$={fragment:null,ctx:null,props:h,update:t,not_equal:a,bound:i(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:i(),dirty:c,skip_bound:!1};let f=!1;if(p.ctx=n?n(e,d,(t,i,...s)=>{const o=s.length?s[0]:i;return p.ctx&&a(p.ctx[t],p.ctx[t]=o)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](o),f&&F(e,t)),i}):[],p.update(),f=!0,s(p.before_update),p.fragment=!!r&&r(p.ctx),o.target){if(o.hydrate){const t=function(t){return Array.from(t.childNodes)}(o.target);p.fragment&&p.fragment.l(t),t.forEach(l)}else p.fragment&&p.fragment.c();o.intro&&D(e.$$.fragment),j(e,o.target,o.anchor),G()}x(u)}class C{$destroy(){z(this,1),this.$destroy=t}$on(t,e){const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(e),()=>{const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}class W{constructor(t){this.delete=!1,this.position=t.position,this.velocity=t.velocity,this.radius=t.size,this.lifeSpan=t.lifeSpan,this.inertia=.98}destroy(){this.delete=!0}render(t){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.velocity.x*=this.inertia,this.velocity.y*=this.inertia,this.radius-=.1,this.radius<.1&&(this.radius=.1),this.lifeSpan--<0&&this.destroy();const e=t.context;e.save(),e.translate(this.position.x,this.position.y),e.fillStyle="#ffffff",e.lineWidth=2,e.beginPath(),e.moveTo(0,-this.radius),e.arc(0,0,this.radius,0,2*Math.PI),e.closePath(),e.fill(),e.restore()}}function H(t,e,i){return{x:(t.x-e.x)*Math.cos(i)-(t.y-e.y)*Math.sin(i)+e.x,y:(t.x-e.x)*Math.sin(i)+(t.y-e.y)*Math.cos(i)+e.y}}function q(t,e){return Math.random()*(e-t+1)+t}function N(t,e,i,s){let o=q(t,e);for(;o>i&&o<s;)o=Math.random()*(e-t+1)+t;return o}class U{constructor(t){this.delete=!1,this.position=t.position,this.velocity={x:q(-1.5,1.5),y:q(-1.5,1.5)},this.rotation=0,this.rotationSpeed=q(-1,1),this.radius=t.size,this.score=80/this.radius*5,this.create=t.create,this.addScore=t.addScore,this.vertices=function(t,e){let i=[];for(let s=0;s<t;s++)i.push({x:(-Math.sin(360/t*s*Math.PI/180)+Math.round(2*Math.random()-1)*Math.random()/3)*e,y:(-Math.cos(360/t*s*Math.PI/180)+Math.round(2*Math.random()-1)*Math.random()/3)*e});return i}(8,t.size)}destroy(){this.delete=!0,this.addScore(this.score);for(let t=0;t<this.radius;t++){const t=new W({lifeSpan:q(60,100),size:q(1,3),position:{x:this.position.x+q(-this.radius/4,this.radius/4),y:this.position.y+q(-this.radius/4,this.radius/4)},velocity:{x:q(-1.5,1.5),y:q(-1.5,1.5)}});this.create(t,"particles")}if(this.radius>10)for(let t=0;t<2;t++){let t=new U({size:this.radius/2,position:{x:q(-10,20)+this.position.x,y:q(-10,20)+this.position.y},create:this.create.bind(this),addScore:this.addScore.bind(this)});this.create(t,"asteroids")}}render(t){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.rotation+=this.rotationSpeed,this.rotation>=360&&(this.rotation-=360),this.rotation<0&&(this.rotation+=360),this.position.x>t.screen.width+this.radius?this.position.x=-this.radius:this.position.x<-this.radius&&(this.position.x=t.screen.width+this.radius),this.position.y>t.screen.height+this.radius?this.position.y=-this.radius:this.position.y<-this.radius&&(this.position.y=t.screen.height+this.radius);const e=t.context;e.save(),e.translate(this.position.x,this.position.y),e.rotate(this.rotation*Math.PI/180),e.strokeStyle="#FFF",e.lineWidth=2,e.beginPath(),e.moveTo(0,-this.radius);for(let t=1;t<this.vertices.length;t++)e.lineTo(this.vertices[t].x,this.vertices[t].y);e.closePath(),e.stroke(),e.restore()}}class B{constructor(t){this.delete=!1;let e=H({x:0,y:-20},{x:0,y:0},t.ship.rotation*Math.PI/180);this.position={x:t.ship.position.x+e.x,y:t.ship.position.y+e.y},this.rotation=t.ship.rotation,this.velocity={x:e.x/2,y:e.y/2},this.radius=2}destroy(){this.delete=!0}render(t){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,(this.position.x<0||this.position.y<0||this.position.x>t.screen.width||this.position.y>t.screen.height)&&this.destroy();const e=t.context;e.save(),e.translate(this.position.x,this.position.y),e.rotate(this.rotation*Math.PI/180),e.fillStyle="#FFF",e.lineWidth=.5,e.beginPath(),e.arc(0,0,2,0,2*Math.PI),e.closePath(),e.fill(),e.restore()}}class V{constructor(t){this.delete=!1,this.position=t.position,this.velocity={x:0,y:0},this.rotation=0,this.rotationSpeed=6,this.speed=.15,this.inertia=.99,this.radius=20,this.lastShot=0,this.create=t.create,this.onDie=t.onDie}destroy(){this.delete=!0,this.onDie();for(let t=0;t<60;t++){const t=new W({lifeSpan:q(60,100),size:q(1,4),position:{x:this.position.x+q(-this.radius/4,this.radius/4),y:this.position.y+q(-this.radius/4,this.radius/4)},velocity:{x:q(-1.5,1.5),y:q(-1.5,1.5)}});this.create(t,"particles")}}rotate(t){"LEFT"==t&&(this.rotation-=this.rotationSpeed),"RIGHT"==t&&(this.rotation+=this.rotationSpeed)}accelerate(t){this.velocity.x-=Math.sin(-this.rotation*Math.PI/180)*this.speed,this.velocity.y-=Math.cos(-this.rotation*Math.PI/180)*this.speed;let e=H({x:0,y:-10},{x:0,y:0},(this.rotation-180)*Math.PI/180);const i=new W({lifeSpan:q(20,40),size:q(1,3),position:{x:this.position.x+e.x+q(-2,2),y:this.position.y+e.y+q(-2,2)},velocity:{x:e.x/q(3,5),y:e.y/q(3,5)}});this.create(i,"particles")}render(t){if(t.keys.up&&this.accelerate(1),t.keys.left&&this.rotate("LEFT"),t.keys.right&&this.rotate("RIGHT"),t.keys.space&&Date.now()-this.lastShot>300){const t=new B({ship:this});this.create(t,"bullets"),this.lastShot=Date.now()}this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.velocity.x*=this.inertia,this.velocity.y*=this.inertia,this.rotation>=360&&(this.rotation-=360),this.rotation<0&&(this.rotation+=360),this.position.x>t.screen.width?this.position.x=0:this.position.x<0&&(this.position.x=t.screen.width),this.position.y>t.screen.height?this.position.y=0:this.position.y<0&&(this.position.y=t.screen.height);const e=t.context;e.save(),e.translate(this.position.x,this.position.y),e.rotate(this.rotation*Math.PI/180),e.strokeStyle="#ffffff",e.fillStyle="#000000",e.lineWidth=2,e.beginPath(),e.moveTo(0,-15),e.lineTo(10,10),e.lineTo(5,7),e.lineTo(-5,7),e.lineTo(-10,10),e.closePath(),e.fill(),e.stroke(),e.restore()}}function J(t){let e,i,s,o,n,r,a,g,x;return{c(){e=u("div"),i=u("p"),i.textContent="Game over, man!",s=p(),o=u("p"),n=d(t[1]),r=p(),a=u("button"),a.textContent="try again?",f(a,"class","svelte-1u3rjuu"),f(e,"class","endgame svelte-1u3rjuu")},m(l,u){var d,p,f,y;c(l,e,u),h(e,i),h(e,s),h(e,o),h(o,n),h(e,r),h(e,a),g||(d=a,p="click",f=t[4],d.addEventListener(p,f,y),x=()=>d.removeEventListener(p,f,y),g=!0)},p(t,e){2&e&&y(n,t[1])},d(t){t&&l(e),g=!1,x()}}}function K(e){let i,s,o,n,r,a,g,x,m,v,$=e[0].currentScore+"",w=!e[0].inGame&&J(e);return{c(){w&&w.c(),i=p(),s=u("span"),o=d("Score: "),n=d($),r=p(),a=u("span"),g=d("Top Score: "),x=d(e[2]),m=p(),v=u("span"),v.innerHTML="Use [A][S][W][D] or [←][↑][↓][→] to MOVE<br>\n    Use [SPACE] to SHOOT",f(s,"class","score current-score svelte-1u3rjuu"),f(a,"class","score top-score svelte-1u3rjuu"),f(v,"class","controls svelte-1u3rjuu")},m(t,e){w&&w.m(t,e),c(t,i,e),c(t,s,e),h(s,o),h(s,n),c(t,r,e),c(t,a,e),h(a,g),h(a,x),c(t,m,e),c(t,v,e)},p(t,[e]){t[0].inGame?w&&(w.d(1),w=null):w?w.p(t,e):(w=J(t),w.c(),w.m(i.parentNode,i)),1&e&&$!==($=t[0].currentScore+"")&&y(n,$),4&e&&y(x,t[2])},i:t,o:t,d(t){w&&w.d(t),t&&l(i),t&&l(s),t&&l(r),t&&l(a),t&&l(m),t&&l(v)}}}function Q(t,e,i){let{gameData:s}=e,{message:o}=e,{topScore:n}=e,{startGame:r}=e;return t.$$set=t=>{"gameData"in t&&i(0,s=t.gameData),"message"in t&&i(1,o=t.message),"topScore"in t&&i(2,n=t.topScore),"startGame"in t&&i(3,r=t.startGame)},[s,o,n,r,()=>r()]}class X extends C{constructor(t){super(),O(this,t,Q,K,n,{gameData:0,message:1,topScore:2,startGame:3})}}const Y=[];function Z(e,i=t){let s;const o=[];function r(t){if(n(e,t)&&(e=t,s)){const t=!Y.length;for(let t=0;t<o.length;t+=1){const i=o[t];i[1](),Y.push(i,e)}if(t){for(let t=0;t<Y.length;t+=2)Y[t][0](Y[t+1]);Y.length=0}}}return{set:r,update:function(t){r(t(e))},subscribe:function(n,a=t){const h=[n,a];return o.push(h),1===o.length&&(s=i(r)||t),n(e),()=>{const t=o.indexOf(h);-1!==t&&o.splice(t,1),0===o.length&&(s(),s=null)}}}}const tt=Z({width:window.innerWidth,height:window.innerHeight,ratio:window.devicePixelRatio||1}),et=Z({left:!1,right:!1,up:!1,down:!1,space:!1}),it=Z(3),st=Z({currentScore:0,inGame:!1}),ot=Z(localStorage.topscore||0);function nt(e){let i,s,o;return{c(){i=u("canvas"),f(i,"width",s=e[1].width*e[1].ratio),f(i,"height",o=e[1].height*e[1].ratio),f(i,"class","svelte-1skxn5t")},m(t,s){c(t,i,s),e[2](i)},p(t,[e]){2&e&&s!==(s=t[1].width*t[1].ratio)&&f(i,"width",s),2&e&&o!==(o=t[1].height*t[1].ratio)&&f(i,"height",o)},i:t,o:t,d(t){t&&l(i),e[2](null)}}}function rt(t,e,i){let s;r(t,tt,t=>i(1,s=t));let{canvasRef:o}=e;const n=t=>{tt.set({width:window.innerWidth,height:window.innerHeight,ratio:window.devicePixelRatio||1})};return v(()=>{window.addEventListener("resize",n)}),$(()=>{window.removeEventListener("resize",n)}),t.$$set=t=>{"canvasRef"in t&&i(0,o=t.canvasRef)},[o,s,function(t){S[t?"unshift":"push"](()=>{o=t,i(0,o)})}]}class at extends C{constructor(t){super(),O(this,t,rt,nt,n,{canvasRef:0})}}function ht(t){let e,i,s,o,n,r;function a(e){t[5].call(null,e)}i=new X({props:{gameData:t[2],message:t[1],topScore:t[3],startGame:t[4]}});let d={};return void 0!==t[0]&&(d.canvasRef=t[0]),o=new at({props:d}),S.push(()=>function(t,e,i){const s=t.$$.props[e];void 0!==s&&(t.$$.bound[s]=i,i(t.$$.ctx[s]))}(o,"canvasRef",a)),{c(){e=u("div"),R(i.$$.fragment),s=p(),R(o.$$.fragment),f(e,"class","container svelte-vviivg")},m(t,n){c(t,e,n),j(i,e,null),h(e,s),j(o,e,null),r=!0},p(t,[e]){const s={};4&e&&(s.gameData=t[2]),2&e&&(s.message=t[1]),8&e&&(s.topScore=t[3]),i.$set(s);const r={};var a;!n&&1&e&&(n=!0,r.canvasRef=t[0],a=()=>n=!1,k.push(a)),o.$set(r)},i(t){r||(D(i.$$.fragment,t),D(o.$$.fragment,t),r=!0)},o(t){I(i.$$.fragment,t),I(o.$$.fragment,t),r=!1},d(t){t&&l(e),z(i),z(o)}}}function ct(t,e,i){let s,o,n,h,c;r(t,et,t=>i(8,s=t)),r(t,tt,t=>i(9,o=t)),r(t,it,t=>i(10,n=t)),r(t,st,t=>i(2,h=t)),r(t,ot,t=>i(3,c=t));let l,u={ship:[],asteroids:[],bullets:[],particles:[]},d=null;const p=t=>{let e=s;const i="keydown"===t.type;"a"!==t.key.toLowerCase()&&"ArrowLeft"!==t.key||a(et,s.left=i,s),"d"!==t.key.toLowerCase()&&"ArrowRight"!==t.key||a(et,s.right=i,s),"w"!==t.key.toLowerCase()&&"ArrowUp"!==t.key||a(et,s.up=i,s)," "===t.key&&a(et,s.space=i,s),et.set(e)};v(()=>{window.addEventListener("keyup",p),window.addEventListener("keydown",p);const t=l.getContext("2d");g(),d=t,requestAnimationFrame(()=>{f()})}),$(()=>{window.removeEventListener("keyup",p),window.removeEventListener("keydown",p)});const f=()=>{if(null!=d){const t=d;if(t.save(),t.scale(o.ratio,o.ratio),t.fillStyle="#000",t.globalAlpha=.4,t.fillRect(0,0,o.width,o.height),t.globalAlpha=1,!u.asteroids.length){let t=n+1;it.set(t),m(t)}b(u.bullets,u.asteroids),b(u.ship,u.asteroids),S(u.particles,"particles"),S(u.asteroids,"asteroids"),S(u.bullets,"bullets"),S(u.ship,"ship"),t.restore()}requestAnimationFrame(()=>{f()})},y=t=>{h.inGame&&st.update(e=>Object.assign(Object.assign({},e),{currentScore:e.currentScore+t}))},g=()=>{st.set({inGame:!0,currentScore:0});const t=new V({position:{x:o.width/2,y:o.height/2},create:w.bind(this),onDie:x.bind(this)});w(t,"ship"),u.asteroids=[],m(n)},x=()=>{st.update(t=>Object.assign(Object.assign({},t),{inGame:!1})),h.currentScore>c&&(ot.set(h.currentScore),localStorage.topscore=h.currentScore)},m=t=>{let e=u.ship[0];for(let i=0;i<t;i++){let t=new U({size:80,position:{x:N(0,o.width,e.position.x-60,e.position.x+60),y:N(0,o.height,e.position.y-60,e.position.y+60)},create:w.bind(this),addScore:y.bind(this)});w(t,"asteroids")}},w=(t,e)=>{u[e].push(t)},S=(t,e)=>{let i=0;for(let r of t)r.delete?u[e].splice(i,1):t[i].render({screen:o,context:d,keys:s,asteroidCount:n,topScore:c,currentScore:h.currentScore,inGame:h.inGame}),i++},b=(t,e)=>{for(var i,s=t.length-1;s>-1;--s)for(i=e.length-1;i>-1;--i){var o=t[s],n=e[i];k(o,n)&&(o.destroy(),n.destroy())}},k=(t,e)=>{var i=t.position.x-e.position.x,s=t.position.y-e.position.y;return Math.sqrt(i*i+s*s)<t.radius+e.radius};let M;return t.$$.update=()=>{12&t.$$.dirty&&(h.currentScore<=0?i(1,M="0 points... So sad."):h.currentScore>=c?i(1,M="Top score with "+h.currentScore+" points. Woo!"):i(1,M=h.currentScore+" Points though :)"))},[l,M,h,c,g,function(t){l=t,i(0,l)}]}return new class extends C{constructor(t){super(),O(this,t,ct,ht,n,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
